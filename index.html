<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Vanilla by idevz</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Vanilla</h1>
        <h2>An OpenResty Lua MVC Web Framework</h2>

        <section id="downloads">
          <a href="https://github.com/idevz/vanilla/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/idevz/vanilla/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/idevz/vanilla" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h2>
<a id="vanilla--香草中文文档--osc-git" class="anchor" href="#vanilla--%E9%A6%99%E8%8D%89%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3--osc-git" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Vanilla / (香草<a href="README-zh.md">中文文档</a>) / OSC <a href="http://git.oschina.net/idevz/vanilla">Git</a>
</h2>

<p><a href="https://travis-ci.org/idevz/vanilla"><img src="https://travis-ci.org/idevz/vanilla.svg?branch=master" alt="https://travis-ci.org/idevz/vanilla.svg?branch=master"></a>
<a href="https://gitter.im/idevz/vanilla?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/idevz/vanilla.svg" alt="Join the chat at https://gitter.im/idevz/vanilla"></a>
<a href="http://issuestats.com/github/idevz/vanilla"><img src="http://issuestats.com/github/idevz/vanilla/badge/pr" alt="Issue Stats"></a>
<a href="http://issuestats.com/github/idevz/vanilla"><img src="http://issuestats.com/github/idevz/vanilla/badge/issue" alt="Issue Stats"></a></p>

<p><em>Vanilla is An OpenResty Lua MVC Web Framework.</em></p>

<p><img src="http://m1.sinaimg.cn/maxwidth.300/m1.sinaimg.cn/120d7329960e19cf073f264751e8d959_2043_2241.png" alt="Vanilla"></p>

<h3>
<a id="maillist" class="anchor" href="#maillist" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>MailList</em>
</h3>

<ul>
<li>vanilla-en <a href="mailto:vanilla-en@googlegroups.com">vanilla-en@googlegroups.com</a>
</li>
<li>vanilla-devel <a href="mailto:vanilla-devel@googlegroups.com">vanilla-devel@googlegroups.com</a>
</li>
<li>vanilla中文邮件列表 <a href="mailto:vanilla@googlegroups.com">vanilla@googlegroups.com</a>
</li>
</ul>

<h3>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Install</em>
</h3>

<h4>
<a id="vanilla-v010-rc41-or-the-older-vanillas-installation-to-see-readme-v010-rc41md" class="anchor" href="#vanilla-v010-rc41-or-the-older-vanillas-installation-to-see-readme-v010-rc41md" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Vanilla-V0.1.0-rc4.1 Or the older Vanillas Installation to see: <a href="README/README-V0.1.0-rc4.1.md">README-V0.1.0-rc4.1.md</a></em>
</h4>

<h4>
<a id="use-setup-framework-install-vanilla" class="anchor" href="#use-setup-framework-install-vanilla" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Use ./setup-framework Install Vanilla</em>
</h4>

<p><em><code>./setup-framework</code> is a auto script to <code>make install</code> Vanilla, only need to set OpenResty install path to install Vanilla in a simple way</em></p>

<pre><code>./setup-framework -h
Usage: ./setup-framework
                 -h   show this help info
                 -v   VANILLA_PROJ_ROOT, vanilla project root, will contain vanilla framework and apps
                 -o   OPENRESTY_ROOT, openresty install path(openresty root)
</code></pre>

<p>Options of <code>./setup-framework</code>:</p>

<ul>
<li><p>-v : Set Vanilla project root, Default is <code>/data/vanilla</code>, So Vanilla installed at <code>/data/vanilla/framework/0_1_0_rc5/vanilla/</code> directory.</p></li>
<li><p>-o : Set OpenResty install path, Default is <code>/usr/local/openresty</code>, if its different from your OpenResty install path,set to yours.</p></li>
</ul>

<p>Here is the Directory Structure:</p>

<pre><code>tree /data/vanilla -L 2
/data/vanilla
├── framework
│   ├── 0_1_0_rc5
│   └── 0_1_0_rc5.old_2016_04_12_11_04_18 # Repeat the installation will mv the older one to an time backup.
</code></pre>

<h4>
<a id="use-make-install-cmd-to-install-vanilla" class="anchor" href="#use-make-install-cmd-to-install-vanilla" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Use <code>make install</code> cmd to install Vanilla</em>
</h4>

<p><em>Vanilla support many configuration options, many of those option have default value.</em></p>

<p>You can use default installation but if your enviroment values different from which vanilla default, please config it with yours.
Especially the <code>--openresty-path</code> option. you should make sure it's point to your turely OpenResty install path.
You can run command <code>./configure --help</code> to learn how to use those options. </p>

<p>Below is the installation of a simple example:</p>

<pre><code>./configure --prefix=/usr/local/vanilla --openresty-path=/usr/local/openresty

make install
</code></pre>

<h3>
<a id="vanilla-usage" class="anchor" href="#vanilla-usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Vanilla usage</h3>

<h4>
<a id="vanilla-v010-rc41-or-the-older-vanillas-installation-to-see-readme-zh-v010-rc41md" class="anchor" href="#vanilla-v010-rc41-or-the-older-vanillas-installation-to-see-readme-zh-v010-rc41md" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Vanilla-V0.1.0-rc4.1 Or the older Vanillas Installation to see: <a href="README/README-zh-V0.1.0-rc4.1.md">README-zh-V0.1.0-rc4.1.md</a></em>
</h4>

<h4>
<a id="vanilla-cmds" class="anchor" href="#vanilla-cmds" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Vanilla CMDs</em>
</h4>

<p><em>Vanilla-V0.1.0-rc5 always support two cmds, but from rc5, each cmd just like the framework itselvese generate with an  version number like <code>vanilla-0.1.0.rc5</code>, and <code>v-console-0.1.0.rc5</code>, this is good for muilt version vanilla coexistence and painless upgrade Vanilla.</em></p>

<ul>
<li>
<code>vanilla-0.1.0.rc5</code> use to init an app skeleton, after <code>vanilla-0.1.0.rc5</code> we use an script in the app root named <code>va-appname-service</code> to manage the app service but not <code>vanilla-0.1.0.rc5</code> cmd,  see below for the use details of script <code>va-appname-service</code>.</li>
<li>
<code>v-console-0.1.0.rc5</code> is an interactive command line, its mainly to provide a convenient learning Lua tools with many building Vanilla libs just like lprint_r fuction to output and table.</li>
</ul>

<h4>
<a id="building-up-an-application-skeleton" class="anchor" href="#building-up-an-application-skeleton" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Building up an application skeleton</em>
</h4>

<pre><code>vanilla-0.1.0.rc5 new app_full_path                         #use cmd `vanilla-0.1.0.rc5` to auto create an app skeleton, Attention to give an full path as an param, but not just an APP_NAME
chmod +x app_full_path/va-appname-service                   #add an execute permissions to va-appname-service
app_full_path/va-appname-service initconf [dev]             #init the nginx config for the app, the nginx config file base on the config file in app_full_path/nginx_conf, if you have any personal configration, you should add thire into those config files first, then you can execute the initconf action, param [dev] is an optional one, add this for development environment, default empty for production environment.
app_full_path/va-appname-service start [dev]                #start this inited service, then you can visit it through http://localhost, it also have a [dev] option just like initconf.
</code></pre>

<p>These multi process can be simply completed through script <code>./setup-vanilal-demoapp</code>:</p>

<pre><code>./setup-vanilal-demoapp -h
Usage: ./setup-vanilal-demoapp -h   show this help info
                 -a   VANILLA_APP_ROOT, app absolute path(which path to init app)
                 -u   VANILLA_APP_USER, user to run app
                 -g   VANILLA_APP_GROUP, user group to run app
                 -e   VANILLA_RUNNING_ENV, app running environment
</code></pre>

<p>Options of <code>./setup-vanilal-demoapp</code></p>

<ul>
<li>-a : Set a abslute full path for Application, Default is <code>/data/vanilla/vademo</code>
</li>
<li>-u : Set the username to run nginx service, Default is idevz</li>
<li>-g : Set the usergroup to run nginx service, Default is sina</li>
<li>-e : Set the running enviroment, Default is '' for production environment.</li>
</ul>

<p>Here is the Directory Structure:</p>

<pre><code>tree /data/vanilla/ -L 1
/data/vanilla/
├── framework                             # vanilla framework path
├── vademo                                # demo app "vademo" path
└── vademo.old_2016_04_12_11_04_26        # Repeat the installation will mv the older one to an time backup.
</code></pre>

<h4>
<a id="application-init-and-service-management" class="anchor" href="#application-init-and-service-management" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Application init and service management</em>
</h4>

<p><em>We use script <code>/data/vanilla/vademo/va-vademo-service</code> to manage the vademo service</em></p>

<pre><code>/data/vanilla/vademo/va-vademo-service -h
Usage: ./va-ok-service {start|stop|restart|reload|force-reload|confinit[-f]|configtest} [dev] #dev set up the running environment, none dev for default production envionment.
</code></pre>

<p>Tips:* You should run cmd <code>/data/vanilla/vademo/va-vademo-service initconf [dev]</code> first if you new the App didn't use the <code>/data/vanilla/vademo/va-vademo-service</code> script but run cmd <code>vanilla-0.1.0.rc5 new vademo</code> to new an app by hand.*</p>

<h4>
<a id="directory-structure" class="anchor" href="#directory-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Directory Structure</em>
</h4>

<pre><code> /Users/zj-git/app_name/ tree ./
./
├── application
│   ├── bootstrap.lua --application boot
│   ├── controllers
│   │   ├── error.lua --application error handling, dealing with corresponding business under this path error
│   │   └── index.lua --vanilla hello world
│   ├── library       --local libs
│   ├── models 
│   │   ├── dao       --data handles for DB, APIs
│   │   │   └── table.lua
│   │   └── service   --encapsulations of DAOs
│   │       └── user.lua
│   ├── nginx         --openresy http phases
│   │   └── init.lua  --init_by_lua demo
│   ├── plugins
│   └── views         --one to one correspondence to controllers
│       ├── error     --error handle view layout
│       │   └── error.html
│       └── index     --index controller views
│           └── index.html
├── config
│   ├── application.lua --app basic configuration such as router,initialization settings...
│   ├── errors.lua    --app error conf
│   ├── nginx.conf    --nginx.conf skeleton
│   ├── nginx.lua     --nginx settings like lua_code_cache.
│   ├── waf-regs      --WAF rules
│   │   ├── args
│   │   ├── cookie
│   │   ├── post
│   │   ├── url
│   │   ├── user-agent
│   │   └── whiteurl
│   └── waf.lua       --app WAF config
├── logs
│   └── hack          --attack logs, keep path can be write
├── pub               --app content_by_lua_file path
    └── index.lua     --entrance file
</code></pre>

<h4>
<a id="indexcontroller-demo" class="anchor" href="#indexcontroller-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>IndexController Demo</em>
</h4>

<pre><code>local IndexController = {}

function IndexController:index()
    local view = self:getView()
    local p = {}
    p['vanilla'] = 'Welcome To Vanilla...'
    p['zhoujing'] = 'Power by Openresty'
    view:assign(p)
    return view:display()
end

return IndexController
</code></pre>

<h5>
<a id="template-demo-viewsindexindexhtml" class="anchor" href="#template-demo-viewsindexindexhtml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Template demo (views/index/index.html)</em>
</h5>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;img src="http://m1.sinaimg.cn/maxwidth.300/m1.sinaimg.cn/120d7329960e19cf073f264751e8d959_2043_2241.png"&gt;
  &lt;h1&gt;&lt;a href = 'https://github.com/idevz/vanilla'&gt;{{vanilla}}&lt;/a&gt;&lt;/h1&gt;&lt;h5&gt;{{zhoujing}}&lt;/h5&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<h3>
<a id="why-vanilla" class="anchor" href="#why-vanilla" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why Vanilla</h3>

<p><em>To answer this question, we just need to see what Openresty has done and Vanilla has done.</em></p>

<h4>
<a id="openresty" class="anchor" href="#openresty" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Openresty</em>
</h4>

<ul>
<li>Provides processing HTTP requests a full set of the overall solution</li>
<li>Opened up a new way for Nginx module development, we can use Lua to deal with Web requests</li>
<li>Formed an increasingly perfect ecology, the ecological covers all aspects of high-performance Web services </li>
</ul>

<h4>
<a id="vanilla" class="anchor" href="#vanilla" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>Vanilla</em>
</h4>

<ul>
<li>Implement a Web development routine debugging, error handling, exception handling</li>
<li>Implement complete processing of the request and plug-in mechanism, support routing protocol, the template engine configuration</li>
<li>Integration, encapsulates a series of Web development commonly used tool set, class library (cookies, application firewall, etc.)</li>
<li>Features easy to use and extend</li>
<li>Support  different environment (development, test, online)</li>
<li>Focus on the business development, not any about nginx nor OpenResty</li>
<li>Based on OpenResty, have all the good qualities of OpenResty</li>
<li>Automated, Nginx instruction set of configuration management</li>
<li>More reasonable use Openresty encapsulation of request processing Phase</li>
</ul>

<h3>
<a id="community" class="anchor" href="#community" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Community</h3>

<h4>
<a id="qq-groupswechat-public-no" class="anchor" href="#qq-groupswechat-public-no" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><em>QQ Groups&amp;&amp;WeChat public no.</em>
</h4>

<ul>
<li><em>Openresty/Vanilla Dev:205773855 (Vanilla panel discussion related topics)</em></li>
<li><em>Openresty:34782325(Discuss OpenResty and all kinds of advanced technology)</em></li>
<li><em>WeChat public no. of Vanilla Dev:Vanilla-OpenResty(Vanilla related information, document push)</em></li>
</ul>

<p><a href="http://shang.qq.com/wpa/qunwpa?idkey=673157ee0f0207ce2fb305d15999225c5aa967e88913dfd651a8cf59e18fd459"><img src="http://pub.idqqimg.com/wpa/images/group.png" alt="QQ"></a></p>
      </section>
    </div>

    
  </body>
</html>
