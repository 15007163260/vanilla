#!/usr/bin/env lua
package.path="/Users/zhoujing/.luarocks/share/lua/5.1/?.lua;/Users/zhoujing/.luarocks/share/lua/5.1/?/init.lua;/usr/local/luarocks-2.2.2/share/lua/5.1/?.lua;/usr/local/luarocks-2.2.2/share/lua/5.1/?/init.lua;"..package.path
package.cpath="/Users/zhoujing/.luarocks/lib/lua/5.1/?.so;/usr/local/luarocks-2.2.2/lib/lua/5.1/?.so;"..package.cpath
local V = require 'vanilla.sys.config'

local help_description = [[Vanilla v]] .. V.version .. [[, An Opentresty Web Framework For PHPER.

Usage: vanilla COMMAND [ARGS] [OPTIONS]

The available vanilla commands are:
 new [name]             Create a new Vanilla application
 start                  Starts the Vanilla server
 stop                   Stops the Vanilla server

Options:
 --trace                Shows additional logs
]]

local launcher = require 'vanilla.sys.vanilla'
local application = require 'vanilla.sys.application'

-- check trace
V_TRACE = false
if arg[#arg] == '--trace' then
  table.remove(arg, #arg)
  V_TRACE = true
end

-- check args
if arg[1] == 'new' and arg[2] then application.new(arg[2])
elseif arg[1] == 'start' then launcher.start()
elseif arg[1] == 'stop' then launcher.stop()
else print(help_description)
end